<script>
async function callApi(endpoint, method = "GET") {
  try {
    const res = await fetch(`/api/${endpoint}`, { method });

    // Handle HTML vs JSON responses
    const contentType = res.headers.get("content-type") || "";
    const isJson = contentType.includes("application/json");
    const data = isJson ? await res.json() : { error: "Unexpected response" };

    if (res.status === 401) {
      // Not logged in ‚Äî redirect to login
      window.location.href = "/.auth/login/aad";
      return;
    }

    if (res.status === 403) {
      // Logged in but no group access
      document.getElementById("output").innerHTML =
        `<div style="color:red;font-weight:bold;">üö´ Access Denied</div>
         <div>You do not have permission to use this feature.</div>`;
      return;
    }

    if (!res.ok) {
      throw new Error(data?.error || "Unknown API error");
    }

    return data;
  } catch (err) {
    document.getElementById("output").innerHTML =
      `<div style="color:red;font-weight:bold;">‚ö†Ô∏è Error</div>
       <div>${err.message}</div>`;
  }
}
</script>
