<script>
  // … lookup DOM elements & login/logout setup …

  function setButtons({ isUser, isAdmin }) {
    statusBtn.disabled = !(isUser || isAdmin);
    startBtn.disabled  = !(isUser || isAdmin);
    stopBtn.disabled   = !isAdmin;
  }

  async function checkAuth() {
    const res = await fetch('/.auth/me', { credentials: 'same-origin' });
    if (res.redirected) {
      show('Please log in to use the app.', 'error');
      return;
    }
    const { clientPrincipal: principal } = await res.json();
    if (!principal) {
      show('Please log in to use the app.', 'error');
      return;
    }

    loginBtn.style.display  = 'none';
    logoutBtn.style.display = 'inline-block';
    show(`✅ Logged in as ${principal.userDetails}`, 'success');

    // NEW: just check App Role values
    const roles = Array.isArray(principal.userRoles)
      ? principal.userRoles.map(r => r.toLowerCase())
      : [];

    setButtons({
      isUser:  roles.includes('user'),
      isAdmin: roles.includes('admin')
    });
  }

  // … callApi, event listeners, checkAuth() …
</script>
